import{b as R,u as W,r as a,j as e,A as _,g as p,d as h,e as m}from"./index-0SUTSTHz.js";import{P as F}from"./Pagination-Dyhzepp4.js";const z=()=>{const N=R(),{hasPermission:S}=W(),[b,P]=a.useState([]),[y,C]=a.useState([]),[M,A]=a.useState([]),[E,I]=a.useState([]),[L,k]=a.useState(!0),[f,j]=a.useState(null),[c,T]=a.useState(""),[l,q]=a.useState("all"),[i,B]=a.useState("all"),[g,w]=a.useState(1),x=10;a.useEffect(()=>{(async()=>{k(!0),j(null);try{const[r,s,o,d]=await Promise.all([p(h(m,"products")),p(h(m,"warehouses")),p(h(m,"categories")),p(h(m,"brands"))]);P(r.docs.map(n=>({id:n.id,...n.data()}))),C(s.docs.map(n=>({id:n.id,...n.data()}))),A(o.docs.map(n=>({id:n.id,...n.data()}))),I(d.docs.map(n=>({id:n.id,...n.data()})))}catch(r){j("Impossible de charger les données de stock."),console.error(r)}finally{k(!1)}})()},[]),a.useEffect(()=>{w(1)},[c,l,i]);const u=a.useMemo(()=>b.filter(t=>{if(t.type==="service")return!1;const r=t.name.toLowerCase().includes(c.toLowerCase())||t.sku.toLowerCase().includes(c.toLowerCase()),s=l==="all"||t.categoryId===l,o=i==="all"||t.brandId===i;return r&&s&&o}),[b,c,l,i]),v=a.useMemo(()=>u.slice((g-1)*x,g*x),[u,g]),D=Math.ceil(u.length/x),U=(t,r)=>{var s,o;return((o=(s=t.stockLevels)==null?void 0:s.find(d=>d.warehouseId===r))==null?void 0:o.quantity)??0},$=t=>(t.stockLevels||[]).reduce((r,s)=>r+s.quantity,0),K=(t="blue")=>({blue:"border-blue-500",emerald:"border-emerald-500",purple:"border-purple-500",orange:"border-orange-500",red:"border-red-500",cyan:"border-cyan-500",indigo:"border-indigo-500",rose:"border-rose-500"})[t]||"border-blue-500";return L?e.jsx("div",{className:"p-12 text-center text-gray-400 font-black uppercase animate-pulse tracking-widest",children:"Chargement de l'inventaire global..."}):f?e.jsx("div",{className:"p-8 text-center text-red-500 font-bold bg-red-50 rounded-2xl",children:f}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black text-gray-900 dark:text-white uppercase tracking-tight",children:"État des Stocks"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Vue consolidée de tous les points de stockage."})]}),S("inventory:adjustments")&&e.jsxs("button",{onClick:()=>N("/inventory/adjustments"),className:"flex items-center px-6 py-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 font-black uppercase text-xs shadow-xl transition-all active:scale-95",children:[e.jsx(_,{className:"w-5 h-5 mr-2"}),"Nouvel ajustement"]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-3xl shadow-xl border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Chercher nom ou SKU...",value:c,onChange:t=>T(t.target.value),className:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-900/50 border-none rounded-xl focus:ring-2 focus:ring-primary-500 font-medium"}),e.jsxs("select",{value:l,onChange:t=>q(t.target.value),className:"w-full px-3 py-2 border rounded-xl dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"Toutes les catégories"}),M.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:i,onChange:t=>B(t.target.value),className:"w-full px-3 py-2 border rounded-xl dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"Toutes les marques"}),E.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-2xl rounded-3xl border border-gray-100 dark:border-gray-700 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-primary-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-[10px] font-black text-white uppercase tracking-widest",children:"Produit / SKU"}),y.map(t=>e.jsx("th",{className:`px-6 py-4 text-right text-[10px] font-black text-white uppercase tracking-widest border-b-4 ${K(t.color)}`,children:t.name},t.id)),e.jsx("th",{className:"px-6 py-4 text-right text-[10px] font-black text-white uppercase tracking-widest bg-primary-700",children:"Total Phys."}),e.jsx("th",{className:"px-6 py-4 text-right text-[10px] font-black text-white uppercase tracking-widest bg-primary-700",children:"Seuil Alerte"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-100 dark:bg-gray-800 dark:divide-gray-700",children:[v.map(t=>{const r=$(t),s=r<=t.minStockAlert;return e.jsxs("tr",{className:`${s?"bg-red-50 dark:bg-red-900/20":"hover:bg-gray-50 dark:hover:bg-gray-700/30"} transition-colors`,children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 dark:text-white uppercase tracking-tight",children:t.name}),e.jsx("div",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:t.sku})]}),y.map(o=>{const d=U(t,o.id);return e.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm text-right font-bold ${d<=0?"text-gray-300":"text-gray-700 dark:text-gray-200"}`,children:d},o.id)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-black text-gray-900 dark:text-white text-right bg-gray-50/50 dark:bg-gray-900/20",children:e.jsx("span",{className:s?"text-red-600 animate-pulse":"",children:r})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-[10px] text-right font-black text-gray-400 uppercase tracking-widest",children:[t.minStockAlert," Unités"]})]},t.id)}),v.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:y.length+3,className:"py-24 text-center text-gray-400 font-black uppercase tracking-widest opacity-30",children:"Aucun produit ne correspond à la recherche"})})]})]})})}),e.jsx(F,{currentPage:g,totalPages:D,onPageChange:w,totalItems:u.length,itemsPerPage:x})]})};export{z as default};
