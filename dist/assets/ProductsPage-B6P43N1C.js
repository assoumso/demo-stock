import{u as we,b as Ne,r as l,j as e,D as Y,P as J,h as ve,I as Q,E as Se,m as Ce,n as Ie,T as Pe,W as De,g as k,d as w,e as o,p as Ae,k as X,s as Me}from"./index-0SUTSTHz.js";import{M as L}from"./Modal-D7o8EM96.js";import{P as Ee}from"./Pagination-Dyhzepp4.js";import{D as Te,a as M}from"./DropdownMenu-DJOgdqBT.js";const Fe=()=>{var K,_;const{hasPermission:p}=we(),N=Ne(),[O,E]=l.useState([]),[$,Z]=l.useState([]),[F,ee]=l.useState([]),[te,se]=l.useState([]),[U,ae]=l.useState([]),[re,B]=l.useState(!0),[W,v]=l.useState(null),[S,le]=l.useState(""),[g,ie]=l.useState("all"),[h,ce]=l.useState("all"),[x,ne]=l.useState("all"),[n,u]=l.useState([]),[de,C]=l.useState(!1),[m,G]=l.useState(null),[oe,I]=l.useState(!1),[xe,b]=l.useState(!1),[a,pe]=l.useState(null),[y,R]=l.useState(1),P=10,me=async()=>{B(!0),v(null);try{const[t,s,r,c,d]=await Promise.all([k(w(o,"products")),k(w(o,"categories")),k(w(o,"brands")),k(w(o,"units")),k(w(o,"warehouses"))]);E(t.docs.map(i=>({id:i.id,...i.data()}))),Z(s.docs.map(i=>({id:i.id,...i.data()}))),ee(r.docs.map(i=>({id:i.id,...i.data()}))),se(c.docs.map(i=>({id:i.id,...i.data()}))),ae(d.docs.map(i=>({id:i.id,...i.data()})))}catch(t){console.error("Error fetching products data:",t),v("Impossible de charger les données des produits.")}finally{B(!1)}};l.useEffect(()=>{me()},[]),l.useEffect(()=>{R(1)},[S,g,h,x]),l.useEffect(()=>{u([])},[y]);const D=l.useMemo(()=>O.filter(t=>{const s=S.toLowerCase(),r=g==="all"||t.categoryId===g,c=h==="all"||t.brandId===h,d=s===""||t.name.toLowerCase().includes(s)||t.sku.toLowerCase().includes(s),i=x==="all"||t.stockLevels&&t.stockLevels.some(q=>q.warehouseId===x);return r&&c&&d&&i}),[O,S,g,h,x]),A=l.useMemo(()=>D.slice((y-1)*P,y*P),[D,y]),ge=Math.ceil(D.length/P),V=t=>{var s;return((s=$.find(r=>r.id===t))==null?void 0:s.name)||"Général"},z=t=>{var s;return((s=F.find(r=>r.id===t))==null?void 0:s.name)||"Sans Marque"},f=t=>{var s;return((s=te.find(r=>r.id===t))==null?void 0:s.name)||"Unité"},T=t=>{var s;return x==="all"?(t.stockLevels||[]).reduce((r,c)=>r+c.quantity,0):((s=(t.stockLevels||[]).find(r=>r.warehouseId===x))==null?void 0:s.quantity)||0},he=t=>{G(t),C(!0)},ue=t=>{pe(t),b(!0)},be=async()=>{if(m)try{await Ae(X(o,"products",m.id)),E(t=>t.filter(s=>s.id!==m.id)),G(null),C(!1)}catch{v("Erreur lors de la suppression du produit.")}},H=t=>{const{id:s,sku:r,...c}=t,d=`${r}-COPY-${Date.now().toString().slice(-4)}`;N("/products/new",{state:{productToDuplicate:{...c,sku:d}}})},ye=t=>{u(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},fe=t=>{if(t.target.checked){const s=A.map(r=>r.id);u(s)}else u([])},je=async()=>{try{const t=Me(o);n.forEach(s=>{t.delete(X(o,"products",s))}),await t.commit(),E(s=>s.filter(r=>!n.includes(r.id))),u([]),I(!1)}catch{v("Erreur lors de la suppression groupée.")}},j=t=>new Intl.NumberFormat("fr-FR").format(t)+" FCFA",ke=A.length>0&&n.length===A.length;return e.jsxs("div",{className:"pb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black text-gray-900 dark:text-white uppercase tracking-tight",children:"Catalogue Articles"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Gérez vos produits physiques et vos prestations de services."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[p("products:delete")&&n.length>0&&e.jsxs("button",{onClick:()=>I(!0),className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 font-bold uppercase text-xs transition-all shadow-lg",children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),"Supprimer (",n.length,")"]}),p("products:create")&&e.jsxs("button",{onClick:()=>N("/products/new"),className:"flex items-center px-6 py-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 font-black uppercase text-xs shadow-xl transition-all hover:scale-[1.02] active:scale-95",children:[e.jsx(J,{className:"w-5 h-5 mr-2"}),"Ajouter un Article"]})]})]}),e.jsx("div",{className:"mb-6 bg-white dark:bg-gray-800 p-4 rounded-3xl shadow-xl border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Nom ou SKU...",value:S,onChange:t=>le(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-50 dark:bg-gray-900/50 rounded-xl border-none focus:ring-2 focus:ring-primary-500 font-medium"}),e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:e.jsx(ve,{className:"w-4 h-4"})})]}),e.jsx("div",{children:e.jsxs("select",{value:g,onChange:t=>ie(t.target.value),className:"w-full px-3 py-2 border rounded-xl dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"Toutes catégories"}),$.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx("div",{children:e.jsxs("select",{value:h,onChange:t=>ce(t.target.value),className:"w-full px-3 py-2 border rounded-xl dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"Toutes marques"}),F.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx("div",{children:e.jsxs("select",{value:x,onChange:t=>ne(t.target.value),className:"w-full px-3 py-2 border rounded-xl dark:bg-gray-700 dark:border-gray-600",children:[e.jsx("option",{value:"all",children:"Stock Global"}),U.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})})]})}),re?e.jsx("div",{className:"p-24 text-center text-gray-400 font-black uppercase tracking-widest animate-pulse",children:"Chargement du catalogue..."}):W?e.jsx("p",{className:"text-red-500 font-bold text-center p-8 bg-red-50 rounded-2xl",children:W}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-2xl rounded-3xl border border-gray-100 dark:border-gray-700 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-primary-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 w-10 text-center",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-primary-900 border-white rounded focus:ring-0 cursor-pointer",checked:ke,onChange:fe})}),e.jsx("th",{className:"px-6 py-4 text-left text-[10px] font-black text-white uppercase tracking-widest",children:"Aperçu"}),e.jsx("th",{className:"px-6 py-4 text-left text-[10px] font-black text-white uppercase tracking-widest",children:"Identité Article"}),e.jsx("th",{className:"px-6 py-4 text-left text-[10px] font-black text-white uppercase tracking-widest",children:"Catégorie / Marque"}),e.jsx("th",{className:"px-6 py-4 text-right text-[10px] font-black text-white uppercase tracking-widest",children:"Prix Vente"}),e.jsx("th",{className:"px-6 py-4 text-right text-[10px] font-black text-white uppercase tracking-widest",children:"Stock"}),e.jsx("th",{className:"px-6 py-4 text-right text-[10px] font-black text-white uppercase tracking-widest",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:A.map(t=>e.jsxs("tr",{className:`${n.includes(t.id)?"bg-primary-50 dark:bg-primary-900/10":"hover:bg-gray-50 dark:hover:bg-gray-700/30"} transition-colors`,children:[e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-primary-600 rounded cursor-pointer",checked:n.includes(t.id),onChange:()=>ye(t.id)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"w-12 h-12 flex-shrink-0 bg-gray-50 dark:bg-gray-900 rounded-xl overflow-hidden border dark:border-gray-700 flex items-center justify-center",children:t.imageUrl?e.jsx("img",{className:"w-full h-full object-cover",src:t.imageUrl,alt:t.name}):e.jsx(Q,{className:"w-6 h-6 text-gray-300"})})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 dark:text-white uppercase tracking-tighter",children:t.name}),e.jsxs("div",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest flex items-center mt-1",children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${t.type==="service"?"bg-blue-500":"bg-green-500"}`}),t.sku]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-xs font-medium text-gray-500 dark:text-gray-400",children:[e.jsx("div",{className:"font-black text-primary-600 uppercase",children:V(t.categoryId)}),e.jsx("div",{className:"uppercase mt-0.5",children:z(t.brandId)})]}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[e.jsx("div",{className:"text-sm font-black text-gray-900 dark:text-white",children:j(t.price)}),e.jsxs("div",{className:"text-[9px] font-bold text-gray-400 uppercase",children:["HT / ",f(t.unitId)]})]}),e.jsx("td",{className:"px-6 py-4 text-right",children:t.type==="service"?e.jsx("span",{className:"text-[10px] text-gray-300 uppercase font-black italic",children:"Service"}):e.jsxs("div",{className:`inline-flex flex-col items-end px-3 py-1 rounded-xl ${T(t)<=t.minStockAlert?"bg-red-50 text-red-600 dark:bg-red-900/20":"bg-gray-50 text-gray-700 dark:bg-gray-900/40 dark:text-gray-300"}`,children:[e.jsx("span",{className:"text-sm font-black",children:T(t)}),T(t)<=t.minStockAlert&&e.jsx("span",{className:"text-[8px] font-black uppercase animate-pulse",children:"Alerte"})]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs(Te,{children:[e.jsxs(M,{onClick:()=>ue(t),children:[e.jsx(Se,{className:"w-4 h-4 mr-3 text-blue-500"})," Aperçu détaillé"]}),p("products:edit")&&e.jsxs(M,{onClick:()=>N(`/products/edit/${t.id}`),children:[e.jsx(Ce,{className:"w-4 h-4 mr-3"})," Modifier"]}),p("products:create")&&e.jsxs(M,{onClick:()=>H(t),children:[e.jsx(Ie,{className:"w-4 h-4 mr-3 text-purple-500"})," Dupliquer"]}),e.jsx("div",{className:"border-t dark:border-gray-700 my-1"}),p("products:delete")&&e.jsxs(M,{onClick:()=>he(t),className:"text-red-600 font-bold",children:[e.jsx(Y,{className:"w-4 h-4 mr-3"})," Supprimer"]})]})})]},t.id))})]})})}),e.jsx(Ee,{currentPage:y,totalPages:ge,onPageChange:R,totalItems:D.length,itemsPerPage:P})]}),e.jsxs(L,{isOpen:de,onClose:()=>C(!1),title:"Confirmation",children:[e.jsx("div",{className:"p-6",children:e.jsxs("p",{className:"text-sm font-bold text-gray-600",children:["Supprimer définitivement l'article ",e.jsxs("span",{className:"text-red-600 uppercase",children:['"',m==null?void 0:m.name,'"']})," ?"]})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{onClick:be,className:"w-full inline-flex justify-center rounded-xl px-6 py-2 bg-red-600 text-xs font-black text-white hover:bg-red-700 sm:ml-3 sm:w-auto uppercase tracking-widest transition-all",children:"Supprimer"}),e.jsx("button",{onClick:()=>C(!1),className:"mt-3 w-full inline-flex justify-center rounded-xl px-6 py-2 bg-white text-xs font-black text-gray-700 hover:bg-gray-50 sm:mt-0 sm:w-auto uppercase tracking-widest border transition-all",children:"Annuler"})]})]}),e.jsxs(L,{isOpen:oe,onClose:()=>I(!1),title:"Suppression Groupée",children:[e.jsx("div",{className:"p-6",children:e.jsxs("p",{className:"text-sm font-bold text-gray-600",children:["Supprimer les ",n.length," articles sélectionnés ? Cette action est irréversible."]})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{onClick:je,className:"w-full inline-flex justify-center rounded-xl px-6 py-2 bg-red-600 text-xs font-black text-white hover:bg-red-700 sm:ml-3 sm:w-auto uppercase tracking-widest transition-all",children:"Tout supprimer"}),e.jsx("button",{onClick:()=>I(!1),className:"mt-3 w-full inline-flex justify-center rounded-xl px-6 py-2 bg-white text-xs font-black text-gray-700 hover:bg-gray-50 sm:mt-0 sm:w-auto uppercase tracking-widest border transition-all",children:"Annuler"})]})]}),e.jsx(L,{isOpen:xe,onClose:()=>b(!1),title:"Fiche Produit Détaillée",maxWidth:"max-w-3xl",children:a&&e.jsxs("div",{className:"p-0 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"bg-gray-900 text-white p-8 relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row md:items-center gap-8",children:[e.jsx("div",{className:"w-32 h-32 md:w-40 md:h-40 bg-white rounded-3xl shadow-2xl p-2 flex-shrink-0 flex items-center justify-center border-4 border-gray-800",children:a.imageUrl?e.jsx("img",{src:a.imageUrl,alt:a.name,className:"w-full h-full object-contain rounded-2xl"}):e.jsx(Q,{className:"w-16 h-16 text-gray-200"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest ${a.type==="service"?"bg-blue-600":"bg-green-600"}`,children:a.type==="service"?"Service":"Produit Physique"}),e.jsxs("span",{className:"px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest bg-gray-700 border border-gray-600",children:["SKU: ",a.sku]})]}),e.jsx("h3",{className:"text-3xl font-black uppercase leading-tight tracking-tighter mb-2",children:a.name}),e.jsxs("p",{className:"text-gray-400 text-sm font-bold uppercase tracking-widest",children:[V(a.categoryId)," • ",z(a.brandId)]})]})]}),e.jsx("div",{className:"absolute top-0 right-0 opacity-10 translate-x-1/4 -translate-y-1/4 pointer-events-none",children:e.jsx(J,{className:"w-64 h-64"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 md:p-8 space-y-10",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-primary-50 dark:bg-primary-900/20 p-5 rounded-3xl border border-primary-100 dark:border-primary-800",children:[e.jsx("p",{className:"text-[10px] font-black text-primary-600 uppercase tracking-widest mb-1",children:"Prix de Vente HT"}),e.jsx("p",{className:"text-2xl font-black text-gray-900 dark:text-white",children:j(a.price)}),e.jsxs("p",{className:"text-[10px] font-bold text-primary-400 uppercase mt-1",children:["Par ",f(a.unitId)]})]}),a.type!=="service"&&p("reports:profit")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-5 rounded-3xl border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1",children:"Coût d'Achat"}),e.jsx("p",{className:"text-2xl font-black text-gray-900 dark:text-white",children:j(a.cost)}),e.jsx("p",{className:"text-[10px] font-bold text-gray-500 uppercase mt-1",children:"Dernière Entrée"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-5 rounded-3xl border border-green-100 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-[10px] font-black text-green-600 uppercase tracking-widest",children:"Marge Brute"}),e.jsx(Pe,{className:"w-4 h-4 text-green-600"})]}),e.jsx("p",{className:"text-2xl font-black text-green-700 dark:text-green-400",children:j(a.price-a.cost)}),e.jsxs("p",{className:"text-[10px] font-bold text-green-600 uppercase mt-1",children:[((a.price-a.cost)/a.price*100).toFixed(1),"% de marge"]})]})]})]}),a.type!=="service"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-black text-gray-900 dark:text-white uppercase tracking-widest flex items-center",children:[e.jsx(De,{className:"w-5 h-5 mr-3 text-primary-500"})," État des Stocks par Site"]}),e.jsx("div",{className:"flex items-center bg-red-50 dark:bg-red-900/20 px-4 py-1.5 rounded-full border border-red-100 dark:border-red-900/40",children:e.jsxs("span",{className:"text-[10px] font-black text-red-600 uppercase tracking-tighter",children:["Alerte : ",a.minStockAlert," ",f(a.unitId)]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:U.map(t=>{var d,i;const s=((i=(d=a.stockLevels)==null?void 0:d.find(q=>q.warehouseId===t.id))==null?void 0:i.quantity)||0,r=s<=a.minStockAlert/2,c=s>a.minStockAlert/2&&s<=a.minStockAlert;return e.jsxs("div",{className:"p-4 rounded-2xl border dark:border-gray-700 bg-white dark:bg-gray-900/40 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700 dark:text-gray-300 uppercase truncate pr-4",children:t.name}),e.jsx("span",{className:`text-sm font-black ${r?"text-red-600":c?"text-orange-500":"text-green-600"}`,children:s})]}),e.jsx("div",{className:"w-full bg-gray-100 dark:bg-gray-800 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-1000 ${r?"bg-red-600":c?"bg-orange-500":"bg-green-500"}`,style:{width:`${Math.min(s/(a.minStockAlert*3)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("span",{className:"text-[9px] font-black text-gray-400 uppercase",children:r?"Critique":c?"Limite":"Optimal"}),e.jsxs("span",{className:"text-[9px] font-black text-gray-400 uppercase",children:[s," ",f(a.unitId)]})]})]},t.id)})}),e.jsxs("div",{className:"bg-gray-900 dark:bg-primary-600 text-white p-6 rounded-3xl flex flex-col md:flex-row justify-between items-center shadow-xl",children:[e.jsxs("div",{className:"text-center md:text-left mb-4 md:mb-0",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest opacity-70",children:"Disponibilité Totale"}),e.jsxs("h5",{className:"text-3xl font-black uppercase tracking-tighter",children:[(K=a.stockLevels)==null?void 0:K.reduce((t,s)=>t+s.quantity,0)," ",f(a.unitId),"S"]})]}),e.jsxs("div",{className:"px-6 py-3 bg-white/10 rounded-2xl border border-white/20 backdrop-blur-md",children:[e.jsx("p",{className:"text-[10px] font-black uppercase text-center",children:"Valeur Actuelle du Stock (Coût)"}),e.jsx("p",{className:"text-xl font-black",children:j((((_=a.stockLevels)==null?void 0:_.reduce((t,s)=>t+s.quantity,0))||0)*a.cost)})]})]})]}),a.description&&e.jsxs("div",{className:"border-t dark:border-gray-700 pt-8",children:[e.jsx("h4",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-4",children:"Notes & Description"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-6 rounded-2xl text-sm text-gray-600 dark:text-gray-400 leading-relaxed italic border border-dashed dark:border-gray-700",children:a.description})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-t dark:border-gray-700 p-6 flex flex-col sm:flex-row gap-4 justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{b(!1),N(`/products/edit/${a.id}`)},className:"px-6 py-2.5 bg-primary-600 text-white rounded-xl font-black text-[10px] uppercase tracking-widest shadow-lg hover:bg-primary-700 transition-all",children:"Modifier l'Article"}),e.jsx("button",{onClick:()=>{b(!1),H(a)},className:"px-6 py-2.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-xl font-black text-[10px] uppercase tracking-widest border dark:border-gray-600 hover:bg-gray-200 transition-all",children:"Dupliquer"})]}),e.jsx("button",{onClick:()=>b(!1),className:"w-full sm:w-auto px-10 py-2.5 bg-gray-900 text-white rounded-xl font-black text-[10px] uppercase tracking-widest shadow-xl hover:scale-105 active:scale-95 transition-all",children:"Fermer la Fiche"})]})]})})]})};export{Fe as default};
