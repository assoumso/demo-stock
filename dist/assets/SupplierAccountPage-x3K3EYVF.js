import{t as E,b as I,r as i,j as e,F as $,G as L,i as q,k as B,e as u,q as G,d as k,w as U,g as w}from"./index-szRe9_7c.js";import{r as v}from"./index-CzGh6JR1.js";const Y=()=>{const{id:o}=E(),x=I(),m=i.useRef(null),[a,D]=i.useState(null),[P,g]=i.useState(!0),[b,S]=i.useState([]),[c,A]=i.useState({totalPurchased:0,totalPaid:0,balance:0});i.useEffect(()=>{(async()=>{if(o){g(!0);try{const d=await q(B(u,"suppliers",o));if(!d.exists()){x("/suppliers");return}D({id:d.id,...d.data()});const F=G(k(u,"purchases"),U("supplierId","==",o)),p=(await w(F)).docs.map(t=>({id:t.id,...t.data()})),f=p.map(t=>t.id);let y=[];f.length>0&&(y=(await w(k(u,"purchasePayments"))).docs.map(r=>({id:r.id,...r.data()})).filter(r=>f.includes(r.purchaseId)));const l=[];p.forEach(t=>{l.push({date:t.date,ref:t.referenceNumber,description:"Facture d'achat",debit:0,credit:t.grandTotal,balance:0,type:"purchase"}),t.paidAmount>0&&l.push({date:t.date,ref:t.referenceNumber,description:"Règlement initial effectué",debit:t.paidAmount,credit:0,balance:0,type:"payment"})}),y.forEach(t=>{const r=p.find(T=>T.id===t.purchaseId);l.push({date:t.date,ref:`REG-${t.id.slice(-4).toUpperCase()}`,description:`Règlement facture ${(r==null?void 0:r.referenceNumber)||""}`,debit:t.amount,credit:0,balance:0,type:"payment"})}),l.sort((t,r)=>new Date(t.date).getTime()-new Date(r.date).getTime());let h=0,N=0,j=0;const C=l.map(t=>(h+=t.credit-t.debit,N+=t.credit,j+=t.debit,{...t,balance:h}));S(C),A({totalPurchased:N,totalPaid:j,balance:h})}catch(d){console.error("Erreur de chargement du compte fournisseur:",d)}finally{g(!1)}}})()},[o,x]);const R=(v.useReactToPrint||v)({content:()=>m.current}),n=s=>new Intl.NumberFormat("fr-FR").format(s)+" FCFA";return P?e.jsx("div",{className:"p-12 text-center text-gray-500 font-bold animate-pulse",children:"Analyse des flux fournisseur..."}):e.jsxs("div",{className:"space-y-8 max-w-6xl mx-auto pb-12",children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 no-print",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>x("/suppliers"),className:"p-3 mr-4 bg-white dark:bg-gray-800 rounded-full shadow-lg hover:scale-110 transition-transform border dark:border-gray-700",children:e.jsx($,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-black text-gray-900 dark:text-white uppercase tracking-tight",children:"Fiche Compte Fournisseur"}),e.jsxs("p",{className:"text-sm text-red-600 font-black uppercase tracking-widest",children:[a==null?void 0:a.name," ",a!=null&&a.businessName?`(${a.businessName})`:""]})]})]}),e.jsxs("button",{onClick:R,className:"flex items-center px-6 py-3 bg-gray-900 text-white rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-black transition-all shadow-xl",children:[e.jsx(L,{className:"w-5 h-5 mr-2"})," Imprimer Grand Livre"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 no-print",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-xl border-t-4 border-gray-400",children:[e.jsx("p",{className:"text-xs font-black text-gray-400 uppercase tracking-widest mb-1",children:"Total Facturé par Fournisseur"}),e.jsx("p",{className:"text-2xl font-black text-gray-900 dark:text-white",children:n(c.totalPurchased)})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-xl border-t-4 border-green-500",children:[e.jsx("p",{className:"text-xs font-black text-gray-400 uppercase tracking-widest mb-1",children:"Total Payé (Décaissé)"}),e.jsx("p",{className:"text-2xl font-black text-green-600",children:n(c.totalPaid)})]}),e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-xl border-t-4 ${c.balance>0?"border-red-500":"border-blue-500"}`,children:[e.jsx("p",{className:"text-xs font-black text-gray-400 uppercase tracking-widest mb-1",children:"Dette Actuelle"}),e.jsx("p",{className:`text-2xl font-black ${c.balance>0?"text-red-600":"text-blue-600"}`,children:n(c.balance)})]})]}),e.jsxs("div",{ref:m,className:"bg-white dark:bg-gray-800 rounded-3xl shadow-2xl overflow-hidden border dark:border-gray-700 p-4 sm:p-10",children:[e.jsx("div",{className:"hidden print:block mb-10 border-b-2 border-gray-900 pb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black uppercase text-gray-900",children:(a==null?void 0:a.businessName)||(a==null?void 0:a.name)}),e.jsxs("p",{className:"text-gray-600 font-medium",children:["Adresse: ",(a==null?void 0:a.address)||"N/A"]}),e.jsxs("p",{className:"text-gray-600 font-medium",children:["Contact: ",a==null?void 0:a.phone," | ",a==null?void 0:a.email]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"text-xl font-black underline uppercase",children:"Extrait de Compte Fournisseur"}),e.jsxs("p",{className:"text-sm font-bold text-gray-500",children:["Date d'édition: ",new Date().toLocaleDateString("fr-FR")]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-[10px] font-black uppercase text-gray-500 tracking-widest",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-[10px] font-black uppercase text-gray-500 tracking-widest",children:"Référence"}),e.jsx("th",{className:"px-4 py-4 text-left text-[10px] font-black uppercase text-gray-500 tracking-widest",children:"Désignation"}),e.jsx("th",{className:"px-4 py-4 text-right text-[10px] font-black uppercase text-green-600 tracking-widest",children:"Débit (-)"}),e.jsx("th",{className:"px-4 py-4 text-right text-[10px] font-black uppercase text-red-600 tracking-widest",children:"Crédit (+)"}),e.jsx("th",{className:"px-4 py-4 text-right text-[10px] font-black uppercase text-gray-500 tracking-widest bg-gray-100 dark:bg-gray-700",children:"Solde Dette"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:[b.map((s,d)=>e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors ${s.debit>0?"italic":""}`,children:[e.jsx("td",{className:"px-4 py-4 text-xs font-bold whitespace-nowrap",children:new Date(s.date).toLocaleDateString("fr-FR")}),e.jsx("td",{className:"px-4 py-4 text-xs font-black text-primary-600 uppercase tracking-tighter",children:s.ref}),e.jsxs("td",{className:"px-4 py-4 text-xs text-gray-600 dark:text-gray-300 font-medium",children:[s.description,s.description==="Règlement initial effectué"&&e.jsx("span",{className:"ml-2 text-[8px] px-1 bg-green-100 text-green-700 rounded uppercase font-black",children:"Comptant"})]}),e.jsx("td",{className:"px-4 py-4 text-xs text-right font-bold text-green-600",children:s.debit>0?n(s.debit):"-"}),e.jsx("td",{className:"px-4 py-4 text-xs text-right font-bold text-red-600",children:s.credit>0?n(s.credit):"-"}),e.jsx("td",{className:`px-4 py-4 text-xs text-right font-black bg-gray-50/50 dark:bg-gray-900/20 ${s.balance>0?"text-red-600":"text-blue-600"}`,children:n(s.balance)})]},d)),b.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-24 text-center text-gray-400 font-black uppercase tracking-widest opacity-30",children:"Aucun historique d'achat ou de paiement pour ce fournisseur"})})]})]})}),e.jsxs("div",{className:"hidden print:grid grid-cols-2 gap-8 mt-12 pt-8 border-t-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-[10px] font-black uppercase mb-16 underline",children:"Visa du Responsable Achats"})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("p",{className:"text-lg font-black uppercase",children:["Dette Arrêtée à: ",n(c.balance)]}),e.jsx("p",{className:"text-[10px] font-bold text-gray-500 uppercase",children:c.balance>0?"Solde à régler":"Compte Fournisseur Apuré"})]}),e.jsx("p",{className:"text-[10px] font-black uppercase underline",children:"Cachet Direction ETS-YABABOU"})]})]})]})]})};export{Y as default};
