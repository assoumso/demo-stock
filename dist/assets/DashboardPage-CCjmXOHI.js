import{u as P,b as B,r as c,j as e,T as W,C as T,S as $,c as H,W as G,q as J,d as h,e as k,o as K,g as y}from"./index-0SUTSTHz.js";const U=()=>{const{user:s}=P(),M=B(),[f,E]=c.useState([]),[z,L]=c.useState([]),[j,F]=c.useState([]),[N,R]=c.useState([]),[q,v]=c.useState(!0);c.useEffect(()=>{(async()=>{v(!0);try{const r=J(h(k,"sales"),K("date","desc")),[t,d,o,p]=await Promise.all([y(r),y(h(k,"customers")),y(h(k,"products")),y(h(k,"warehouses"))]);E(t.docs.map(l=>({id:l.id,...l.data()}))),L(d.docs.map(l=>({id:l.id,...l.data()}))),F(o.docs.map(l=>({id:l.id,...l.data()}))),R(p.docs.map(l=>({id:l.id,...l.data()})))}catch(r){console.error("Dashboard error",r)}finally{v(!1)}})()},[]);const x=a=>new Intl.NumberFormat("fr-FR").format(a)+" FCFA",S={amber:{card:"bg-amber-100 dark:bg-amber-900/30 border-amber-300 dark:border-amber-700",text:"text-amber-700 dark:text-amber-300",heading:"text-amber-900 dark:text-amber-100",bar:"bg-amber-500",badge:"bg-amber-200 dark:bg-amber-800 text-amber-900 dark:text-amber-100",accent:"bg-white/50 dark:bg-black/20 border-amber-200 dark:border-amber-800"},blue:{card:"bg-blue-100 dark:bg-blue-900/30 border-blue-300 dark:border-blue-700",text:"text-blue-700 dark:text-blue-300",heading:"text-blue-900 dark:text-blue-100",bar:"bg-blue-500",badge:"bg-blue-200 dark:bg-blue-800 text-blue-900 dark:text-blue-100",accent:"bg-white/50 dark:bg-black/20 border-blue-200 dark:border-blue-800"},emerald:{card:"bg-emerald-100 dark:bg-emerald-900/30 border-emerald-300 dark:border-emerald-700",text:"text-emerald-700 dark:text-emerald-300",heading:"text-emerald-900 dark:text-emerald-100",bar:"bg-emerald-500",badge:"bg-emerald-200 dark:bg-emerald-800 text-emerald-900 dark:text-emerald-100",accent:"bg-white/50 dark:bg-black/20 border-emerald-200 dark:border-emerald-800"},rose:{card:"bg-rose-100 dark:bg-rose-900/30 border-rose-300 dark:border-rose-700",text:"text-rose-700 dark:text-rose-300",heading:"text-rose-900 dark:text-rose-100",bar:"bg-rose-500",badge:"bg-rose-200 dark:bg-rose-800 text-rose-900 dark:text-rose-100",accent:"bg-white/50 dark:bg-black/20 border-rose-200 dark:border-rose-800"},purple:{card:"bg-purple-100 dark:bg-purple-900/30 border-purple-300 dark:border-purple-700",text:"text-purple-700 dark:text-purple-300",heading:"text-purple-900 dark:text-purple-100",bar:"bg-purple-500",badge:"bg-purple-200 dark:bg-purple-800 text-purple-900 dark:text-purple-100",accent:"bg-white/50 dark:bg-black/20 border-purple-200 dark:border-purple-800"},indigo:{card:"bg-indigo-100 dark:bg-indigo-900/30 border-indigo-300 dark:border-indigo-700",text:"text-indigo-700 dark:text-indigo-300",heading:"text-indigo-900 dark:text-indigo-100",bar:"bg-indigo-500",badge:"bg-indigo-200 dark:bg-indigo-800 text-indigo-900 dark:text-indigo-100",accent:"bg-white/50 dark:bg-black/20 border-indigo-200 dark:border-indigo-800"},cyan:{card:"bg-cyan-100 dark:bg-cyan-900/30 border-cyan-300 dark:border-cyan-700",text:"text-cyan-700 dark:text-cyan-300",heading:"text-cyan-900 dark:text-cyan-100",bar:"bg-cyan-500",badge:"bg-cyan-200 dark:bg-cyan-800 text-cyan-900 dark:text-cyan-100",accent:"bg-white/50 dark:bg-black/20 border-cyan-200 dark:border-cyan-800"},orange:{card:"bg-orange-100 dark:bg-orange-900/30 border-orange-300 dark:border-orange-700",text:"text-orange-700 dark:text-orange-300",heading:"text-orange-900 dark:text-orange-100",bar:"bg-orange-500",badge:"bg-orange-200 dark:bg-orange-800 text-orange-900 dark:text-orange-100",accent:"bg-white/50 dark:bg-black/20 border-orange-200 dark:border-orange-800"}},I=c.useMemo(()=>{var a;return s?(a=s.role)!=null&&a.name.toLowerCase().includes("admin")?N:N.filter(r=>{var t;return(t=s.warehouseIds)==null?void 0:t.includes(r.id)}):[]},[s,N]),n=c.useMemo(()=>{if(!s||!s.role)return[];if(s.role.name.toLowerCase().includes("admin"))return f;const a=s.warehouseIds||[];return f.filter(r=>a.includes(r.warehouseId))},[s,f]),w=c.useMemo(()=>{const a=new Date;a.setHours(0,0,0,0);const r=["blue","emerald","rose","purple","indigo","cyan","orange"];let t=0;return I.map(d=>{let o=0,p=0,l=0,V=0;j.forEach(i=>{var b;if(i.type==="service")return;const g=(b=i.stockLevels)==null?void 0:b.find(u=>u.warehouseId===d.id);g&&g.quantity>0&&(o+=g.quantity*(i.cost||0),p+=g.quantity)}),n.forEach(i=>{if(i.warehouseId!==d.id)return;new Date(i.date)>=a&&(l+=i.grandTotal,i.items.forEach(b=>{const u=j.find(A=>A.id===b.productId);u&&(V+=(b.price-(u.cost||0))*b.quantity)}))});let C="amber";return d.isMain||(C=d.color||r[t%r.length],t++),{...d,totalValue:o,totalItems:p,dailyVendu:l,dailyBenefice:V,theme:S[C]||S.blue}}).sort((d,o)=>d.isMain?-1:o.isMain?1:o.totalValue-d.totalValue)},[I,j,n]),D=c.useMemo(()=>w.reduce((a,r)=>a+r.totalValue,0),[w]),m=c.useMemo(()=>{const a=new Date;return a.setHours(0,0,0,0),{salesToday:n.filter(t=>new Date(t.date)>=a).reduce((t,d)=>t+d.grandTotal,0),totalRevenue:n.reduce((t,d)=>t+(d.paidAmount||0),0),totalSales:n.length,activeCustomers:new Set(n.map(t=>t.customerId)).size}},[n]);return q?e.jsx("div",{className:"p-24 text-center text-gray-400 font-black uppercase animate-pulse",children:"Initialisation du Dashboard..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex justify-between items-end px-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black text-gray-900 dark:text-white uppercase tracking-tight",children:"Tableau de bord"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Bienvenue au centre de contrôle, ",e.jsx("span",{className:"text-primary-600 font-bold",children:(s==null?void 0:s.displayName)||(s==null?void 0:s.username)}),"!"]})]}),e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Date"}),e.jsx("p",{className:"font-bold text-gray-700 dark:text-gray-300",children:new Date().toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-[2rem] p-6 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"p-2 bg-green-50 dark:bg-green-900/20 rounded-xl text-green-600",children:e.jsx(W,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-[10px] font-black text-green-500 uppercase",children:"Cumul"})]}),e.jsx("p",{className:"text-[10px] font-black uppercase text-gray-400 tracking-widest mb-1",children:"Encaissements Totaux"}),e.jsx("p",{className:"text-2xl font-black text-gray-900 dark:text-white",children:x(m.totalRevenue)})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-[2rem] p-6 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/20 rounded-xl text-blue-600",children:e.jsx(T,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-[10px] font-black text-blue-500 uppercase",children:"Volume"})]}),e.jsx("p",{className:"text-[10px] font-black uppercase text-gray-400 tracking-widest mb-1",children:"Transactions Ventes"}),e.jsx("p",{className:"text-2xl font-black text-gray-900 dark:text-white",children:m.totalSales})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-[2rem] p-6 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"p-2 bg-primary-50 dark:bg-primary-900/20 rounded-xl text-primary-600",children:e.jsx($,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-[10px] font-black text-primary-500 uppercase",children:"Aujourd'hui"})]}),e.jsx("p",{className:"text-[10px] font-black uppercase text-gray-400 tracking-widest mb-1",children:"Ventes Globales Jour"}),e.jsx("p",{className:"text-2xl font-black text-primary-600",children:x(m.salesToday)})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-[2rem] p-6 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"p-2 bg-gray-50 dark:bg-gray-700 rounded-xl text-gray-600",children:e.jsx(H,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-[10px] font-black text-gray-400 uppercase",children:"Portefeuille"})]}),e.jsx("p",{className:"text-[10px] font-black uppercase text-gray-400 tracking-widest mb-1",children:"Clients Servis"}),e.jsx("p",{className:"text-2xl font-black text-gray-900 dark:text-white",children:m.activeCustomers})]})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 px-2",children:[e.jsx("div",{className:"bg-gray-900 text-white p-2 rounded-xl",children:e.jsx(G,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-xl font-black uppercase tracking-tight text-gray-900 dark:text-white",children:"Performance par Site"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:w.map(a=>{const r=D>0?a.totalValue/D*100:0,t=a.theme;return e.jsxs("div",{className:`group flex flex-col rounded-[2.5rem] border-2 shadow-sm transition-all hover:shadow-2xl hover:-translate-y-1 ${t.card}`,children:[e.jsxs("div",{className:"p-7",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:`text-base font-black uppercase tracking-tight truncate ${t.heading}`,children:a.name}),e.jsx("p",{className:`text-[9px] font-bold uppercase tracking-widest mt-1 opacity-70 ${t.text}`,children:a.location||"Localisation non définie"})]}),e.jsxs("span",{className:`text-[10px] font-black px-3 py-1 rounded-2xl shadow-sm border border-white/50 ${t.badge}`,children:[a.totalItems.toLocaleString()," ART."]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest mb-1 opacity-60 ${t.text}`,children:"Capital Stocké"}),e.jsx("p",{className:`text-2xl font-black ${t.heading}`,children:x(a.totalValue)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full bg-white/40 dark:bg-black/20 h-2.5 rounded-full overflow-hidden shadow-inner border border-white/30",children:e.jsx("div",{className:`${t.bar} h-full transition-all duration-1000 shadow-md`,style:{width:`${r}%`}})}),e.jsxs("div",{className:"flex justify-between items-center text-[9px] font-black opacity-60 uppercase tracking-tighter",children:[e.jsxs("span",{className:t.text,children:[r.toFixed(1),"% de la valeur totale"]}),a.isMain&&e.jsx("span",{className:"bg-gray-900 text-white px-2 py-0.5 rounded-lg",children:"SIÈGE"})]})]})]}),e.jsxs("div",{className:`mt-auto p-7 pt-6 rounded-b-[2.5rem] border-t-2 border-dashed ${t.accent}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx($,{className:`w-4 h-4 ${t.text} animate-pulse`}),e.jsx("span",{className:`text-[11px] font-black uppercase tracking-widest ${t.text}`,children:"Activité du Jour"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[9px] font-black text-gray-500 dark:text-gray-400 uppercase tracking-widest",children:"Vendu"}),e.jsx("p",{className:`text-base font-black ${t.heading}`,children:x(a.dailyVendu)})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("p",{className:"text-[9px] font-black text-gray-500 dark:text-gray-400 uppercase tracking-widest",children:"Bénéfice"}),e.jsxs("p",{className:"text-base font-black text-green-600 dark:text-green-400",children:["+",x(a.dailyBenefice)]})]})]})]})]},a.id)})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-[2.5rem] overflow-hidden border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"p-6 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-900/20",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-600 p-2 rounded-xl",children:e.jsx(T,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-lg font-black uppercase tracking-tight text-gray-900 dark:text-white",children:"Flux des ventes"})]}),e.jsx("button",{onClick:()=>M("/sales"),className:"text-xs font-bold text-primary-600 hover:underline uppercase tracking-widest",children:"Tout l'historique"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50/80 dark:bg-gray-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-8 py-4 text-left text-[10px] font-black uppercase text-gray-400 tracking-widest",children:"Référence / Date"}),e.jsx("th",{className:"px-8 py-4 text-left text-[10px] font-black uppercase text-gray-400 tracking-widest",children:"Paiement"}),e.jsx("th",{className:"px-8 py-4 text-right text-[10px] font-black uppercase text-gray-400 tracking-widest",children:"Montant"})]})}),e.jsxs("tbody",{className:"divide-y dark:divide-gray-700",children:[n.slice(0,6).map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[e.jsxs("td",{className:"px-8 py-5",children:[e.jsx("p",{className:"text-sm font-bold text-gray-900 dark:text-white uppercase tracking-tighter",children:a.referenceNumber}),e.jsx("p",{className:"text-[10px] text-gray-400 font-bold",children:new Date(a.date).toLocaleDateString("fr-FR")})]}),e.jsx("td",{className:"px-8 py-5",children:e.jsx("span",{className:`px-3 py-1 rounded-full font-black uppercase text-[9px] tracking-widest ${a.paymentStatus==="Payé"?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"}`,children:a.paymentStatus})}),e.jsx("td",{className:"px-8 py-5 text-right text-base font-black text-gray-900 dark:text-white",children:x(a.grandTotal)})]},a.id)),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-12 text-center text-gray-400 italic",children:"Aucune vente enregistrée."})})]})]})})]})]})};export{U as default};
