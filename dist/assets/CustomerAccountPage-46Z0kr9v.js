import{t as A,b as I,r as l,j as e,F as $,G as L,T as q,f as G,i as M,k as U,e as g,q as B,d as k,w as O,g as w}from"./index-0SUTSTHz.js";import{r as v}from"./index-zh5gQrWE.js";const H=()=>{const{id:x}=A(),o=I(),h=l.useRef(null),[a,D]=l.useState(null),[C,b]=l.useState(!0),[u,R]=l.useState([]),[n,S]=l.useState({totalDue:0,totalPaid:0,balance:0});l.useEffect(()=>{(async()=>{if(x){b(!0);try{const c=await M(U(g,"customers",x));if(!c.exists()){o("/customers");return}D({id:c.id,...c.data()});const T=B(k(g,"sales"),O("customerId","==",x)),p=(await w(T)).docs.map(t=>({id:t.id,...t.data()})),f=p.map(t=>t.id);let y=[];f.length>0&&(y=(await w(k(g,"salePayments"))).docs.map(r=>({id:r.id,...r.data()})).filter(r=>f.includes(r.saleId)));const d=[];p.forEach(t=>{d.push({date:t.date,ref:t.referenceNumber,description:"Facture de vente",debit:t.grandTotal,credit:0,balance:0,type:"sale"}),t.paidAmount>0&&d.push({date:t.date,ref:t.referenceNumber,description:"Paiement initial reçu",debit:0,credit:t.paidAmount,balance:0,type:"payment"})}),y.forEach(t=>{const r=p.find(F=>F.id===t.saleId);d.push({date:t.date,ref:`REG-${t.id.slice(-4).toUpperCase()}`,description:`Règlement facture ${(r==null?void 0:r.referenceNumber)||""}`,debit:0,credit:t.amount,balance:0,type:"payment"})}),d.sort((t,r)=>new Date(t.date).getTime()-new Date(r.date).getTime());let m=0,j=0,N=0;const E=d.map(t=>(m+=t.debit-t.credit,j+=t.debit,N+=t.credit,{...t,balance:m}));R(E),S({totalDue:j,totalPaid:N,balance:m})}catch(c){console.error("Erreur de chargement du compte:",c)}finally{b(!1)}}})()},[x,o]);const P=(v.useReactToPrint||v)({content:()=>h.current}),i=s=>new Intl.NumberFormat("fr-FR").format(s)+" FCFA";return C?e.jsx("div",{className:"p-12 text-center text-gray-500 font-bold animate-pulse",children:"Génération du relevé en cours..."}):e.jsxs("div",{className:"space-y-8 max-w-6xl mx-auto pb-12",children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 no-print",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>o("/customers"),className:"p-3 mr-4 bg-white dark:bg-gray-800 rounded-full shadow-lg hover:scale-110 transition-transform border dark:border-gray-700",children:e.jsx($,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-black text-gray-900 dark:text-white uppercase tracking-tight",children:"Fiche Compte Client"}),e.jsxs("p",{className:"text-sm text-primary-600 font-black uppercase tracking-widest",children:[a==null?void 0:a.name," ",a!=null&&a.businessName?`(${a.businessName})`:""]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:P,className:"flex items-center px-6 py-3 bg-gray-900 text-white rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-black transition-all shadow-xl",children:[e.jsx(L,{className:"w-5 h-5 mr-2"})," Imprimer Relevé"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 no-print",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-xl border-t-4 border-blue-500",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("p",{className:"text-xs font-black text-gray-400 uppercase tracking-widest",children:"Total Facturé (Débit)"}),e.jsx(q,{className:"w-5 h-5 text-blue-500 opacity-50"})]}),e.jsx("p",{className:"text-2xl font-black text-gray-900 dark:text-white",children:i(n.totalDue)})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-xl border-t-4 border-green-500",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("p",{className:"text-xs font-black text-gray-400 uppercase tracking-widest",children:"Total Encaissé (Crédit)"}),e.jsx("div",{className:"w-5 h-5 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-ping"})})]}),e.jsx("p",{className:"text-2xl font-black text-green-600",children:i(n.totalPaid)})]}),e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-xl border-t-4 ${n.balance>0?"border-red-500":"border-primary-500"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("p",{className:"text-xs font-black text-gray-400 uppercase tracking-widest",children:"Reste à Recouvrer"}),n.balance>0?e.jsx(G,{className:"w-5 h-5 text-red-500"}):e.jsx("div",{className:"text-primary-500 font-bold uppercase text-[10px]",children:"Compte Soldé"})]}),e.jsx("p",{className:`text-2xl font-black ${n.balance>0?"text-red-600":"text-primary-600"}`,children:i(n.balance)})]})]}),e.jsxs("div",{ref:h,className:"bg-white dark:bg-gray-800 rounded-3xl shadow-2xl overflow-hidden border dark:border-gray-700 p-4 sm:p-10",children:[e.jsx("div",{className:"hidden print:block mb-10 border-b-2 border-gray-900 pb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-black uppercase text-gray-900",children:(a==null?void 0:a.businessName)||(a==null?void 0:a.name)}),e.jsxs("p",{className:"text-gray-600 font-medium",children:["Adresse: ",(a==null?void 0:a.address)||"N/A",", ",(a==null?void 0:a.city)||""]}),e.jsxs("p",{className:"text-gray-600 font-medium",children:["Contact: ",a==null?void 0:a.phone," | ",a==null?void 0:a.email]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"text-xl font-black underline uppercase",children:"Extrait de Compte Client"}),e.jsxs("p",{className:"text-sm font-bold text-gray-500",children:["Date d'édition: ",new Date().toLocaleDateString("fr-FR")]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-[10px] font-black uppercase text-gray-500 tracking-widest",children:"Date"}),e.jsx("th",{className:"px-4 py-4 text-left text-[10px] font-black uppercase text-gray-500 tracking-widest",children:"Référence"}),e.jsx("th",{className:"px-4 py-4 text-left text-[10px] font-black uppercase text-gray-500 tracking-widest",children:"Désignation"}),e.jsx("th",{className:"px-4 py-4 text-right text-[10px] font-black uppercase text-gray-500 tracking-widest",children:"Débit (+)"}),e.jsx("th",{className:"px-4 py-4 text-right text-[10px] font-black uppercase text-gray-500 tracking-widest text-green-600",children:"Crédit (-)"}),e.jsx("th",{className:"px-4 py-4 text-right text-[10px] font-black uppercase text-gray-500 tracking-widest bg-gray-100 dark:bg-gray-700",children:"Solde"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:[u.map((s,c)=>e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors ${s.type==="payment"?"italic":""}`,children:[e.jsx("td",{className:"px-4 py-4 text-xs font-bold whitespace-nowrap",children:new Date(s.date).toLocaleDateString("fr-FR")}),e.jsx("td",{className:"px-4 py-4 text-xs font-black text-primary-600 uppercase tracking-tighter",children:s.ref}),e.jsxs("td",{className:"px-4 py-4 text-xs text-gray-600 dark:text-gray-300 font-medium",children:[s.description,s.description==="Paiement initial reçu"&&e.jsx("span",{className:"ml-2 text-[8px] px-1 bg-green-100 text-green-700 rounded uppercase font-black",children:"Comptant"})]}),e.jsx("td",{className:"px-4 py-4 text-xs text-right font-bold text-gray-900 dark:text-white",children:s.debit>0?i(s.debit):"-"}),e.jsx("td",{className:"px-4 py-4 text-xs text-right font-bold text-green-600",children:s.credit>0?i(s.credit):"-"}),e.jsx("td",{className:`px-4 py-4 text-xs text-right font-black bg-gray-50/50 dark:bg-gray-900/20 ${s.balance>0?"text-red-600":"text-blue-600"}`,children:i(s.balance)})]},c)),u.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-24 text-center text-gray-400 font-black uppercase tracking-widest opacity-30",children:"Aucun historique de mouvement pour ce compte"})})]})]})}),e.jsxs("div",{className:"hidden print:grid grid-cols-2 gap-8 mt-12 pt-8 border-t-2 border-dashed border-gray-300",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[10px] font-black uppercase mb-16 underline",children:"Visa du Client"}),e.jsxs("p",{className:"text-[8px] text-gray-400 italic",children:['"Reconnais avoir pris connaissance du solde arrêté au ',new Date().toLocaleDateString("fr-FR"),'"']})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("p",{className:"text-lg font-black uppercase",children:["Solde Débiteur: ",i(n.balance)]}),e.jsx("p",{className:"text-[10px] font-bold text-gray-500 uppercase",children:n.balance>0?"Reste à payer":"Compte en règle"})]}),e.jsx("p",{className:"text-[10px] font-black uppercase underline",children:"Signature et Cachet ETS-DEMO"})]})]})]})]})};export{H as default};
