import{u as U,r as a,j as e,D as N,P as G,m as L,g as R,d as w,e as n,p as q,k as h,x as z,y as H,s as J}from"./index-0SUTSTHz.js";import{M as k}from"./Modal-D7o8EM96.js";import{D as K,a as v}from"./DropdownMenu-DJOgdqBT.js";const Y=()=>{const{hasPermission:y}=U(),[g,S]=a.useState([]),[C,f]=a.useState(!0),[Q,o]=a.useState(null),[D,u]=a.useState(!1),[p,m]=a.useState({}),[j,b]=a.useState(!1),[r,l]=a.useState([]),[I,d]=a.useState(!1),c=async()=>{f(!0);try{const s=await R(w(n,"units"));S(s.docs.map(t=>({id:t.id,...t.data()})))}catch{o("Impossible de charger les unités.")}finally{f(!1)}};a.useEffect(()=>{c()},[]);const M=()=>{b(!1),m({name:""}),u(!0)},E=s=>{b(!0),m(s),u(!0)},x=()=>u(!1),A=async s=>{s.preventDefault();const{id:t,...i}=p;if(i.name)try{j?await z(h(n,"units",t),i):await H(w(n,"units"),i),await c(),x()}catch{o("Erreur d'enregistrement.")}},O=async s=>{if(window.confirm("Supprimer cette unité ?"))try{await q(h(n,"units",s)),await c()}catch{o("Erreur de suppression.")}},B=async()=>{const s=J(n);r.forEach(t=>s.delete(h(n,"units",t))),await s.commit(),await c(),l([]),d(!1)},P=s=>{l(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},F=s=>{s.target.checked?l(g.map(t=>t.id)):l([])};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Gestion des Unités"}),y("units")&&e.jsxs("div",{className:"flex items-center space-x-2",children:[r.length>0&&e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:[e.jsx(N,{className:"w-5 h-5 mr-2"}),"Supprimer (",r.length,")"]}),e.jsxs("button",{onClick:M,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),"Ajouter une unité"]})]})]}),C?e.jsx("p",{children:"Chargement..."}):e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-primary-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",onChange:F,className:"h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-white uppercase",children:"Nom"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-bold text-white uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:g.map(s=>e.jsxs("tr",{className:r.includes(s.id)?"bg-primary-50 dark:bg-gray-700/50":"",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:r.includes(s.id),onChange:()=>P(s.id),className:"h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"})}),e.jsx("td",{className:"px-6 py-4",children:s.name}),e.jsx("td",{className:"px-6 py-4 text-right",children:y("units")&&e.jsxs(K,{children:[e.jsxs(v,{onClick:()=>E(s),children:[e.jsx(L,{className:"w-4 h-4 mr-3"})," Modifier"]}),e.jsxs(v,{onClick:()=>O(s.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:[e.jsx(N,{className:"w-4 h-4 mr-3"})," Supprimer"]})]})})]},s.id))})]})}),e.jsx(k,{isOpen:D,onClose:x,title:j?"Modifier l'unité":"Ajouter une unité",children:e.jsxs("form",{onSubmit:A,className:"p-6 space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Nom de l'unité",value:p.name||"",onChange:s=>m({...p,name:s.target.value}),className:"w-full border rounded p-2 dark:bg-gray-700"}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 bg-gray-200 rounded-md",children:"Annuler"}),e.jsx("button",{type:"submit",className:"bg-primary-600 text-white px-4 py-2 rounded",children:"Sauvegarder"})]})]})}),e.jsxs(k,{isOpen:I,onClose:()=>d(!1),title:"Confirmer la suppression",children:[e.jsx("div",{className:"p-6",children:e.jsxs("p",{children:["Êtes-vous sûr de vouloir supprimer les ",r.length," unités sélectionnées ?"]})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{onClick:B,className:"bg-red-600 text-white px-4 py-2 rounded",children:"Supprimer"}),e.jsx("button",{onClick:()=>d(!1),className:"ml-2 px-4 py-2 bg-gray-200 rounded",children:"Annuler"})]})]})]})};export{Y as default};
