import{u as S,b as D,r as a,j as e,D as g,P as I,E,m as M,g as P,d as A,e as c,p as B,k as y,s as O}from"./index-szRe9_7c.js";import{D as F,a as o}from"./DropdownMenu-Cy-YUqPb.js";import{M as R}from"./Modal-BWnk_ifJ.js";const q=()=>{const{hasPermission:x}=S(),n=D(),[h,f]=a.useState([]),[j,u]=a.useState(!0),[m,d]=a.useState(null),[r,l]=a.useState([]),[b,i]=a.useState(!1),p=async()=>{u(!0),d(null);try{const s=await P(A(c,"suppliers"));f(s.docs.map(t=>({id:t.id,...t.data()})))}catch{d("Impossible de charger les fournisseurs.")}finally{u(!1)}};a.useEffect(()=>{p()},[]);const N=async s=>{if(window.confirm("Supprimer ce fournisseur ?"))try{await B(y(c,"suppliers",s)),await p()}catch{d("Erreur de suppression.")}},w=async()=>{const s=O(c);r.forEach(t=>s.delete(y(c,"suppliers",t))),await s.commit(),await p(),l([]),i(!1)},k=s=>{l(t=>t.includes(s)?t.filter(C=>C!==s):[...t,s])},v=s=>{s.target.checked?l(h.map(t=>t.id)):l([])};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-black text-gray-900 dark:text-white uppercase tracking-tight",children:"Gestion des Fournisseurs"}),x("suppliers")&&e.jsxs("div",{className:"flex items-center space-x-2",children:[r.length>0&&e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:[e.jsx(g,{className:"w-5 h-5 mr-2"}),"Supprimer (",r.length,")"]}),e.jsxs("button",{onClick:()=>n("/suppliers/new"),className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 font-bold uppercase text-sm",children:[e.jsx(I,{className:"w-5 h-5 mr-2"}),"Nouveau fournisseur"]})]})]}),m&&e.jsx("p",{className:"mb-4 text-sm text-red-600 bg-red-100 p-2 rounded-md",children:m}),j?e.jsx("p",{children:"Chargement..."}):e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-2xl border border-gray-100 dark:border-gray-700",children:e.jsx("div",{className:"overflow-x-auto rounded-2xl",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-primary-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",onChange:v,className:"h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"})}),e.jsx("th",{className:"px-6 py-3 text-left text-[10px] font-black text-white uppercase tracking-widest",children:"Identité / Entreprise"}),e.jsx("th",{className:"px-6 py-3 text-left text-[10px] font-black text-white uppercase tracking-widest",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-[10px] font-black text-white uppercase tracking-widest",children:"RCCM / NIF"}),e.jsx("th",{className:"px-6 py-3 text-right text-[10px] font-black text-white uppercase tracking-widest",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:h.map(s=>e.jsxs("tr",{className:r.includes(s.id)?"bg-primary-50 dark:bg-gray-700/50":"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:r.includes(s.id),onChange:()=>k(s.id),className:"h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 dark:text-white uppercase",children:s.name}),s.businessName&&e.jsx("div",{className:"text-[10px] font-black text-gray-400 uppercase",children:s.businessName})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300 font-medium",children:[e.jsx("div",{children:s.phone}),e.jsx("div",{className:"text-[10px] font-bold text-primary-600",children:s.email})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300 font-bold",children:[e.jsx("div",{className:"uppercase",children:s.rccm||"-"}),e.jsx("div",{className:"text-[10px] uppercase",children:s.nif||"-"})]}),e.jsx("td",{className:"px-6 py-4 text-right",children:x("suppliers")&&e.jsxs(F,{children:[e.jsxs(o,{onClick:()=>n(`/suppliers/account/${s.id}`),children:[e.jsx(E,{className:"w-4 h-4 mr-3 text-blue-500"})," Compte Fournisseur"]}),e.jsxs(o,{onClick:()=>n(`/suppliers/edit/${s.id}`),children:[e.jsx(M,{className:"w-4 h-4 mr-3"})," Modifier Profil"]}),e.jsxs(o,{onClick:()=>N(s.id),className:"text-red-600 font-bold",children:[e.jsx(g,{className:"w-4 h-4 mr-3"})," Supprimer"]})]})})]},s.id))})]})})}),e.jsxs(R,{isOpen:b,onClose:()=>i(!1),title:"Confirmer la suppression",children:[e.jsx("div",{className:"p-6",children:e.jsxs("p",{children:["Êtes-vous sûr de vouloir supprimer les ",r.length," fournisseurs sélectionnés ?"]})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{onClick:w,className:"bg-red-600 text-white px-4 py-2 rounded",children:"Supprimer"}),e.jsx("button",{onClick:()=>i(!1),className:"ml-2 px-4 py-2 bg-gray-200 rounded",children:"Annuler"})]})]})]})};export{q as default};
