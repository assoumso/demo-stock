import{r as t,j as e,D as k,P as $,m as H,g as S,d as y,e as d,p as J,k as f,x as K,y as Q,s as U}from"./index-szRe9_7c.js";import{M as C}from"./Modal-BWnk_ifJ.js";import{D as X,a as M}from"./DropdownMenu-Cy-YUqPb.js";const I=[{group:"Tableau de bord",permissions:[{id:"dashboard",name:"Voir le tableau de bord"}]},{group:"Point de Vente (POS)",permissions:[{id:"pos",name:"Accéder au Point de Vente"}]},{group:"Ventes",permissions:[{id:"sales",name:"Voir la liste des ventes"},{id:"sales:create",name:"Créer une vente"},{id:"sales:edit",name:"Modifier une vente"},{id:"sales:delete",name:"Supprimer une vente"},{id:"sales:invoice",name:"Voir la facture de vente"},{id:"sales:payments",name:"Gérer les paiements de vente"}]},{group:"Achats",permissions:[{id:"purchases",name:"Voir la liste des achats"},{id:"purchases:create",name:"Créer un achat"},{id:"purchases:edit",name:"Modifier un achat"},{id:"purchases:delete",name:"Supprimer un achat"},{id:"purchases:invoice",name:"Voir la facture d'achat"},{id:"purchases:payments",name:"Gérer les paiements d'achat"}]},{group:"Produits",permissions:[{id:"products",name:"Voir la liste des produits"},{id:"products:create",name:"Créer un produit"},{id:"products:edit",name:"Modifier un produit"},{id:"products:delete",name:"Supprimer un produit"}]},{group:"Stocks",permissions:[{id:"inventory",name:"Voir les stocks"},{id:"inventory:adjustments",name:"Faire des ajustements de stock"}]},{group:"Transferts",permissions:[{id:"transfers",name:"Gérer les transferts de stock"}]},{group:"Relations",permissions:[{id:"customers",name:"Gérer les clients (Créer, Modifier, Supprimer)"},{id:"suppliers",name:"Gérer les fournisseurs (Créer, Modifier, Supprimer)"}]},{group:"Rapports",permissions:[{id:"reports",name:"Accéder à la page des rapports"},{id:"reports:profit",name:"Voir le rapport de marge (profits)"},{id:"reports:sales",name:"Voir le rapport des ventes"},{id:"reports:services",name:"Voir le rapport des services"},{id:"reports:stock_alert",name:"Voir le rapport d'alerte de stock"},{id:"reports:inventory_value",name:"Voir le rapport de valeur du stock"}]},{group:"Configuration",permissions:[{id:"users",name:"Gérer les utilisateurs (Créer, Modifier, Supprimer)"},{id:"roles",name:"Gérer les rôles et permissions"},{id:"warehouses",name:"Gérer les entrepôts"},{id:"brands",name:"Gérer les marques"},{id:"categories",name:"Gérer les catégories"},{id:"units",name:"Gérer les unités"},{id:"settings",name:"Accéder aux paramètres"}]}],re=()=>{const[b,V]=t.useState([]),[j,D]=t.useState([]),[P,v]=t.useState(!0),[Y,m]=t.useState(null),[o,p]=t.useState([]),[E,u]=t.useState(!1),[G,x]=t.useState(!1),[i,c]=t.useState({}),[N,w]=t.useState(!1),h=async()=>{v(!0);try{const[s,r]=await Promise.all([S(y(d,"roles")),S(y(d,"warehouses"))]);V(s.docs.map(a=>({id:a.id,...a.data()}))),D(r.docs.map(a=>({id:a.id,...a.data()})))}catch{m("Impossible de charger les rôles.")}finally{v(!1)}};t.useEffect(()=>{h()},[]);const R=()=>{w(!1),c({name:"",permissions:[],warehouseIds:[]}),x(!0)},A=s=>{w(!0),c(s),x(!0)},g=()=>x(!1),O=(s,r)=>{const a=i.permissions||[],l=r?[...a,s]:a.filter(n=>n!==s);c(n=>({...n,permissions:l}))},B=(s,r)=>{const a=i.warehouseIds||[],l=r?[...a,s]:a.filter(n=>n!==s);c(n=>({...n,warehouseIds:l}))},T=async s=>{s.preventDefault();const{id:r,...a}=i;if(!a.name){m("Le nom est requis.");return}try{N?await K(f(d,"roles",r),a):await Q(y(d,"roles"),a),await h(),g()}catch{m("Erreur d'enregistrement.")}},W=async s=>{if(window.confirm("Supprimer ce rôle ?"))try{await J(f(d,"roles",s)),await h()}catch{m("Erreur de suppression.")}},q=async()=>{const s=U(d);o.forEach(r=>s.delete(f(d,"roles",r))),await s.commit(),await h(),p([]),u(!1)},F=s=>{p(r=>r.includes(s)?r.filter(a=>a!==s):[...r,s])},z=s=>{s.target.checked?p(b.map(r=>r.id)):p([])},L=s=>{for(const r of I){const a=r.permissions.find(l=>l.id===s);if(a)return a.name}return s},_=s=>{var r;return((r=j.find(a=>a.id===s))==null?void 0:r.name)||"Inconnu"};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Rôles & Permissions"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[o.length>0&&e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:[e.jsx(k,{className:"w-5 h-5 mr-2"}),"Supprimer (",o.length,")"]}),e.jsxs("button",{onClick:R,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-md",children:[e.jsx($,{className:"w-5 h-5 mr-2"}),"Ajouter un Rôle"]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",onChange:z,className:"h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm",children:"Tout sélectionner"})]})}),P?e.jsx("p",{children:"Chargement..."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(s=>e.jsxs("div",{className:`relative bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md ${o.includes(s.id)?"ring-2 ring-primary-500":""}`,children:[e.jsx("div",{className:"absolute top-3 right-3 z-10",children:e.jsx("input",{type:"checkbox",checked:o.includes(s.id),onChange:()=>F(s.id),className:"h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"})}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h2",{className:"text-xl font-bold pr-10",children:s.name}),e.jsxs(X,{children:[e.jsxs(M,{onClick:()=>A(s),children:[e.jsx(H,{className:"w-4 h-4 mr-3"})," Modifier"]}),e.jsxs(M,{onClick:()=>W(s.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:[e.jsx(k,{className:"w-4 h-4 mr-3"})," Supprimer"]})]})]}),e.jsx("h3",{className:"font-semibold text-base mt-4 border-t pt-3 dark:border-gray-700",children:"Permissions"}),e.jsx("ul",{className:"mt-2 space-y-1 text-sm max-h-32 overflow-y-auto",children:s.permissions.sort().map(r=>e.jsxs("li",{className:"text-gray-600 dark:text-gray-300",children:["✓ ",L(r)]},r))}),e.jsx("h3",{className:"font-semibold text-base mt-4 border-t pt-3 dark:border-gray-700",children:"Entrepôts Autorisés (Ventes)"}),e.jsx("ul",{className:"mt-2 space-y-1 text-sm max-h-24 overflow-y-auto",children:s.warehouseIds&&s.warehouseIds.length>0?s.warehouseIds.map(r=>e.jsxs("li",{className:"text-gray-600 dark:text-gray-300",children:["✓ ",_(r)]},r)):e.jsx("li",{className:"text-gray-500 italic",children:"Tous (non restreint par le rôle)"})})]},s.id))}),e.jsx(C,{isOpen:G,onClose:g,title:N?"Modifier le Rôle":"Nouveau Rôle",maxWidth:"max-w-3xl",children:e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Nom du rôle",value:i.name||"",onChange:s=>c({...i,name:s.target.value}),className:"w-full border rounded p-2 dark:bg-gray-700"}),e.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto border rounded p-4 dark:border-gray-600",children:[I.map(s=>e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-gray-200 border-b dark:border-gray-600 pb-2 mb-2",children:s.group}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:s.permissions.map(r=>e.jsxs("label",{className:"flex items-center space-x-2 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[e.jsx("input",{type:"checkbox",checked:(i.permissions||[]).includes(r.id),onChange:a=>O(r.id,a.target.checked),className:"h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:r.name})]},r.id))})]},s.group)),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-gray-200 border-b dark:border-gray-600 pb-2 mb-2 mt-4",children:"Entrepôts Autorisés pour la Vente"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Définissez les entrepôts dans lesquels les utilisateurs avec ce rôle sont autorisés à effectuer des ventes. Si aucun n'est coché, l'accès n'est pas restreint par le rôle (mais peut l'être au niveau de l'utilisateur)."}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:j.map(s=>e.jsxs("label",{className:"flex items-center space-x-2 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[e.jsx("input",{type:"checkbox",checked:(i.warehouseIds||[]).includes(s.id),onChange:r=>B(s.id,r.target.checked),className:"h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.name})]},s.id))})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"submit",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 sm:ml-3 sm:w-auto sm:text-sm",children:"Sauvegarder"}),e.jsx("button",{type:"button",onClick:g,className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-500 shadow-sm px-4 py-2 bg-white dark:bg-gray-600 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-500 sm:mt-0 sm:w-auto sm:text-sm",children:"Annuler"})]})]})}),e.jsxs(C,{isOpen:E,onClose:()=>u(!1),title:"Confirmer la suppression",children:[e.jsx("div",{className:"p-6",children:e.jsxs("p",{children:["Êtes-vous sûr de vouloir supprimer les ",o.length," rôles sélectionnés ?"]})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{onClick:q,className:"bg-red-600 text-white px-4 py-2 rounded",children:"Supprimer"}),e.jsx("button",{onClick:()=>u(!1),className:"ml-2 px-4 py-2 bg-gray-200 rounded",children:"Annuler"})]})]})]})};export{re as default};
