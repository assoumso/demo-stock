import{u as G,r as a,j as e,D as N,P as L,m as R,g as q,d as w,e as n,p as z,k as h,x as H,y as J,s as K}from"./index-szRe9_7c.js";import{M as k}from"./Modal-BWnk_ifJ.js";import{D as Q,a as v}from"./DropdownMenu-Cy-YUqPb.js";const Y=()=>{const{hasPermission:g}=G(),[y,S]=a.useState([]),[C,f]=a.useState(!0),[T,o]=a.useState(null),[D,p]=a.useState(!1),[m,x]=a.useState({}),[j,b]=a.useState(!1),[r,c]=a.useState([]),[I,l]=a.useState(!1),d=async()=>{f(!0);try{const s=await q(w(n,"categories"));S(s.docs.map(t=>({id:t.id,...t.data()})))}catch{o("Impossible de charger les catégories.")}finally{f(!1)}};a.useEffect(()=>{d()},[]);const M=()=>{b(!1),x({name:""}),p(!0)},E=s=>{b(!0),x(s),p(!0)},u=()=>p(!1),A=async s=>{s.preventDefault();const{id:t,...i}=m;if(i.name)try{j?await H(h(n,"categories",t),i):await J(w(n,"categories"),i),await d(),u()}catch{o("Erreur d'enregistrement.")}},O=async s=>{if(window.confirm("Supprimer cette catégorie ?"))try{await z(h(n,"categories",s)),await d()}catch{o("Erreur de suppression.")}},B=async()=>{const s=K(n);r.forEach(t=>s.delete(h(n,"categories",t))),await s.commit(),await d(),c([]),l(!1)},P=s=>{c(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},F=s=>{s.target.checked?c(y.map(t=>t.id)):c([])};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Gestion des Catégories"}),g("categories")&&e.jsxs("div",{className:"flex items-center space-x-2",children:[r.length>0&&e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:[e.jsx(N,{className:"w-5 h-5 mr-2"}),"Supprimer (",r.length,")"]}),e.jsxs("button",{onClick:M,className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700",children:[e.jsx(L,{className:"w-5 h-5 mr-2"}),"Ajouter une catégorie"]})]})]}),C?e.jsx("p",{children:"Chargement..."}):e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-primary-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",onChange:F,className:"h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-white uppercase",children:"Nom"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-bold text-white uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:y.map(s=>e.jsxs("tr",{className:r.includes(s.id)?"bg-primary-50 dark:bg-gray-700/50":"",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:r.includes(s.id),onChange:()=>P(s.id),className:"h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"})}),e.jsx("td",{className:"px-6 py-4",children:s.name}),e.jsx("td",{className:"px-6 py-4 text-right",children:g("categories")&&e.jsxs(Q,{children:[e.jsxs(v,{onClick:()=>E(s),children:[e.jsx(R,{className:"w-4 h-4 mr-3"})," Modifier"]}),e.jsxs(v,{onClick:()=>O(s.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",children:[e.jsx(N,{className:"w-4 h-4 mr-3"})," Supprimer"]})]})})]},s.id))})]})}),e.jsx(k,{isOpen:D,onClose:u,title:j?"Modifier la catégorie":"Ajouter une catégorie",children:e.jsxs("form",{onSubmit:A,className:"p-6 space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Nom de la catégorie",value:m.name||"",onChange:s=>x({...m,name:s.target.value}),className:"w-full border rounded p-2 dark:bg-gray-700"}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 bg-gray-200 rounded-md",children:"Annuler"}),e.jsx("button",{type:"submit",className:"bg-primary-600 text-white px-4 py-2 rounded",children:"Sauvegarder"})]})]})}),e.jsxs(k,{isOpen:I,onClose:()=>l(!1),title:"Confirmer la suppression",children:[e.jsx("div",{className:"p-6",children:e.jsxs("p",{children:["Êtes-vous sûr de vouloir supprimer les ",r.length," catégories sélectionnées ?"]})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{onClick:B,className:"bg-red-600 text-white px-4 py-2 rounded",children:"Supprimer"}),e.jsx("button",{onClick:()=>l(!1),className:"ml-2 px-4 py-2 bg-gray-200 rounded",children:"Annuler"})]})]})]})};export{Y as default};
