import{u as Z,a as K,r as i,k as f,j as e,I as W,U as O,M as F,N as ee,i as se,O as ae,Q as te,V as re,X as ne,J as j,e as h,g as le,d as oe}from"./index-szRe9_7c.js";const N={id:"app-config",companyName:"ETS-YABABOU",companyAddress:"Cotonou, BÃ©nin",companyPhone:"+229 00 00 00 00",companyEmail:"contact@yababou.com",companyContact:"Direction",companyRCCM:"RB/COT/24 B 0000",companyLogoUrl:"",currencySymbol:"FCFA",invoiceFooterText:"Merci de votre confiance. Les marchandises vendues ne sont ni reprises ni Ã©changÃ©es.",saleInvoicePrefix:"VNT-",purchaseInvoicePrefix:"ACH-",defaultTaxRate:0,defaultPosCustomerId:"walkin",themeColor:"amber"},M=["settings","categories","brands","units","warehouses","products","customers","suppliers","sales","salePayments","purchases","purchasePayments","stockAdjustments","warehouseTransfers","users","roles"],de=()=>{const{hasPermission:ie}=Z(),{setTheme:U,availableThemes:v,refreshSettings:b}=K(),[r,y]=i.useState(N),[z,w]=i.useState(!0),[k,C]=i.useState(!1),[S,d]=i.useState(!1),[I,x]=i.useState([]),[T,g]=i.useState(null),[E,p]=i.useState(null),[P,$]=i.useState(null),[A,R]=i.useState(null),D=f(h,"settings","app-config");i.useEffect(()=>{(async()=>{w(!0);try{const a=await se(D);if(a.exists()){const t=a.data();y({...N,...t}),t.companyLogoUrl&&R(t.companyLogoUrl)}}catch{console.warn("ParamÃ¨tres non chargÃ©s ou base vide.")}finally{w(!1)}})()},[]);const l=s=>{const{name:a,value:t}=s.target,n=["defaultTaxRate"].includes(a);y(c=>({...c,[a]:n?parseFloat(t)||0:t}))},B=s=>{const a=s;U(a),y(t=>({...t,themeColor:a}))},G=s=>{var t;const a=(t=s.target.files)==null?void 0:t[0];if(a){$(a);const n=new FileReader;n.onloadend=()=>R(n.result),n.readAsDataURL(a)}},J=async s=>{s.preventDefault(),C(!0),g(null);try{const a={...r};if(P){const t=ae(te,"settings/company_logo");await re(t,P),a.companyLogoUrl=await ne(t)}await j(D,a,{merge:!0}),await b(),p("ParamÃ¨tres enregistrÃ©s avec succÃ¨s !"),setTimeout(()=>p(null),3e3)}catch(a){g(`Erreur d'enregistrement : ${a.message}`)}finally{C(!1)}},V=async()=>{if(window.confirm("IMPORTANT : Cette opÃ©ration va forcer la crÃ©ation de toutes les collections dans votre base Firebase. Voulez-vous continuer ?")){d(!0),x(["ðŸ”Œ Initialisation Firestore..."]);try{await j(f(h,"settings","app-config"),N),x(s=>[...s,"ðŸ Initialisation terminÃ©e !"]),await b(),p("DÃ©ploiement rÃ©ussi.")}catch(s){g(`Ã‰chec : ${s.message}`)}finally{d(!1)}}},_=async()=>{d(!0),x(["ðŸš€ Exportation..."]);try{const s={};for(const c of M){const u=await le(oe(h,c));s[c]=u.docs.map(m=>({id:m.id,...m.data()}))}const a=JSON.stringify(s,null,2),t="data:application/json;charset=utf-8,"+encodeURIComponent(a),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",`EXPORT_SYSTEME_${new Date().toISOString().split("T")[0]}.json`),n.click(),x(c=>[...c,"âœ… Exportation terminÃ©e !"])}catch(s){g(`Erreur export : ${s.message}`)}finally{d(!1)}},q=async s=>{var n;const a=(n=s.target.files)==null?void 0:n[0];if(!a)return;d(!0),x(["ðŸ” Importation en cours..."]);const t=new FileReader;t.onload=async c=>{var u;try{const m=JSON.parse((u=c.target)==null?void 0:u.result);for(const L of M){const H=m[L]||[];for(const X of H){const{id:Y,...Q}=X;await j(f(h,L,Y),Q,{merge:!0})}}await b(),p("Importation rÃ©ussie !"),setTimeout(()=>window.location.reload(),1e3)}catch(m){g(`Erreur import : ${m.message}`)}finally{d(!1)}},t.readAsText(a)};if(z)return e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Chargement des paramÃ¨tres..."});const o="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-lg shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-primary-500 focus:border-primary-500 outline-none transition-all";return e.jsxs("div",{className:"pb-12 max-w-5xl mx-auto space-y-8",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-3xl font-black text-gray-900 dark:text-white uppercase tracking-tight",children:"ParamÃ¨tres SystÃ¨me"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"GÃ©rez l'identitÃ© et les rÃ¨gles globales de votre application."})]}),e.jsxs("form",{onSubmit:J,className:"space-y-8",children:[e.jsxs("section",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-bold mb-6 text-primary-600 dark:text-primary-400 flex items-center",children:[e.jsx("span",{className:"w-8 h-8 bg-primary-100 dark:bg-primary-900/30 rounded-lg flex items-center justify-center mr-3 text-sm",children:"1"}),"IdentitÃ© de l'entreprise"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-300 mb-1",children:"Logo de l'entreprise"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[A?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:A,alt:"AperÃ§u Logo",className:"h-24 w-24 object-contain rounded-xl border-2 border-gray-100 dark:border-gray-600 p-2 bg-white"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 rounded-xl transition-opacity flex items-center justify-center text-white text-[10px] font-bold",children:"CHANGER"})]}):e.jsxs("div",{className:"h-24 w-24 rounded-xl bg-gray-50 dark:bg-gray-700 flex flex-col items-center justify-center text-gray-400 border-2 border-dashed border-gray-200 dark:border-gray-600",children:[e.jsx(W,{className:"w-8 h-8 mb-1 opacity-50"}),e.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Aucun"})]}),e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsxs("span",{className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(O,{className:"w-4 h-4 mr-2"})," SÃ©lectionner un nouveau fichier logo"]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:G})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Nom de l'entreprise"}),e.jsx("input",{type:"text",name:"companyName",value:r.companyName,onChange:l,className:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"TÃ©lÃ©phone"}),e.jsx("input",{type:"text",name:"companyPhone",value:r.companyPhone,onChange:l,className:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Email de contact"}),e.jsx("input",{type:"email",name:"companyEmail",value:r.companyEmail,onChange:l,className:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"RCCM / IFU"}),e.jsx("input",{type:"text",name:"companyRCCM",value:r.companyRCCM,onChange:l,className:o})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Adresse physique"}),e.jsx("input",{type:"text",name:"companyAddress",value:r.companyAddress,onChange:l,className:o})]})]})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-bold mb-6 text-primary-600 dark:text-primary-400 flex items-center",children:[e.jsx("span",{className:"w-8 h-8 bg-primary-100 dark:bg-primary-900/30 rounded-lg flex items-center justify-center mr-3 text-sm",children:"2"}),"SystÃ¨me & Facturation"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Devise (Symbole)"}),e.jsx("input",{type:"text",name:"currencySymbol",value:r.currencySymbol,onChange:l,className:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"TVA par dÃ©faut (%)"}),e.jsx("input",{type:"number",name:"defaultTaxRate",value:r.defaultTaxRate,onChange:l,className:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"ID Client POS dÃ©faut"}),e.jsx("input",{type:"text",name:"defaultPosCustomerId",value:r.defaultPosCustomerId,onChange:l,className:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"PrÃ©fixe Ventes"}),e.jsx("input",{type:"text",name:"saleInvoicePrefix",value:r.saleInvoicePrefix,onChange:l,className:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"PrÃ©fixe Achats"}),e.jsx("input",{type:"text",name:"purchaseInvoicePrefix",value:r.purchaseInvoicePrefix,onChange:l,className:o})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-bold mb-1",children:"Pied de page des factures"}),e.jsx("textarea",{name:"invoiceFooterText",value:r.invoiceFooterText,onChange:l,rows:3,className:o})]})]})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-bold mb-6 text-primary-600 dark:text-primary-400 flex items-center",children:[e.jsx("span",{className:"w-8 h-8 bg-primary-100 dark:bg-primary-900/30 rounded-lg flex items-center justify-center mr-3 text-sm",children:"3"}),"Personnalisation visuelle"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold mb-4",children:"Couleur principale de l'application"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:Object.keys(v).map(s=>e.jsxs("button",{type:"button",onClick:()=>B(s),className:`relative flex items-center justify-center p-4 rounded-xl border-2 transition-all ${r.themeColor===s?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 ring-4 ring-primary-500/10":"border-gray-100 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx("div",{className:"w-6 h-6 rounded-full mr-3 shadow-inner",style:{backgroundColor:`rgb(${v[s][500]})`}}),e.jsx("span",{className:"capitalize font-bold text-sm",children:s==="amber"?"Ambre":s==="teal"?"Turquoise":s==="sky"?"Ciel":"Rose"}),r.themeColor===s&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-primary-500 text-white rounded-full p-1 shadow-lg",children:e.jsx(F,{className:"w-4 h-4"})})]},s))})]})]}),e.jsxs("div",{className:"sticky bottom-6 flex justify-end items-center bg-white/80 dark:bg-gray-900/80 backdrop-blur-md p-4 rounded-2xl shadow-2xl border border-white dark:border-gray-800 z-10",children:[T&&e.jsx("p",{className:"text-red-500 font-bold mr-6 text-sm",children:T}),E&&e.jsx("p",{className:"text-green-500 font-bold mr-6 text-sm",children:E}),e.jsx("button",{type:"submit",disabled:k,className:"px-10 py-4 bg-primary-600 text-white rounded-xl font-black shadow-lg hover:bg-primary-700 active:scale-95 transition-all disabled:opacity-50",children:k?"ENREGISTREMENT...":"SAUVEGARDER LES CHANGEMENTS"})]})]}),e.jsxs("div",{className:"mt-16 bg-gray-900 rounded-3xl overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"p-8 border-b border-gray-800",children:e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("div",{className:"bg-red-500/20 p-3 rounded-2xl",children:e.jsx(F,{className:"w-8 h-8 text-red-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-white uppercase tracking-wider",children:"Zone de Maintenance"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Outils d'initialisation et de sauvegarde de la base de donnÃ©es."})]})]})}),e.jsxs("div",{className:"p-8 grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-2xl border border-gray-700",children:[e.jsx("h3",{className:"text-white font-bold mb-2",children:"Structure de donnÃ©es"}),e.jsx("p",{className:"text-gray-400 text-sm mb-6 leading-relaxed",children:"Si vous installez l'application sur un nouveau projet Firebase, utilisez ce bouton pour crÃ©er automatiquement toutes les collections nÃ©cessaires."}),e.jsx("button",{onClick:V,disabled:S,className:"w-full py-3 bg-red-600 hover:bg-red-700 text-white rounded-xl font-bold transition-all active:scale-95 disabled:opacity-50 uppercase tracking-widest text-xs",children:"Initialiser les collections"})]}),e.jsxs("div",{className:"bg-gray-800/50 p-6 rounded-2xl border border-gray-700",children:[e.jsx("h3",{className:"text-white font-bold mb-4 uppercase tracking-widest text-xs opacity-50",children:"Transfert de donnÃ©es"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:_,disabled:S,className:"w-full flex items-center justify-center py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition-all",children:[e.jsx(ee,{className:"w-5 h-5 mr-2"})," Exporter tout en JSON"]}),e.jsxs("label",{className:"flex flex-col items-center justify-center py-3 px-4 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold transition-all cursor-pointer",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(O,{className:"w-5 h-5 mr-2"})," Importer un fichier JSON"]}),e.jsx("input",{type:"file",accept:".json",onChange:q,className:"hidden"})]})]})]})]}),I.length>0&&e.jsxs("div",{className:"p-8 bg-black",children:[e.jsx("h4",{className:"text-[10px] font-black text-gray-500 uppercase mb-4 tracking-widest",children:"Journal SystÃ¨me"}),e.jsx("div",{className:"font-mono text-[10px] text-green-400 space-y-1 max-h-40 overflow-y-auto",children:I.map((s,a)=>e.jsxs("div",{children:["[",new Date().toLocaleTimeString(),"] ",s]},a))})]})]})]})};export{de as default};
