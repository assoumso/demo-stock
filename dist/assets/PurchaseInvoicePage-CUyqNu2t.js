import{t as P,b as E,r as l,j as e,F as T,G as R,k as v,e as m,i as w,g as S,d as C}from"./index-0SUTSTHz.js";const k=({purchase:t,supplier:r,products:i,companyInfo:a})=>{const c=n=>new Intl.NumberFormat("fr-FR").format(n)+` ${a.currencySymbol||"FCFA"}`,x=t.items.reduce((n,d)=>n+d.subtotal,0),h=t.grandTotal-t.paidAmount;return e.jsxs("div",{className:"bg-white text-black p-8 font-sans invoice-template flex flex-col justify-between",style:{width:"210mm",minHeight:"297mm",margin:"auto"},children:[e.jsxs("header",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[a.logoUrl&&e.jsx("img",{src:a.logoUrl,alt:"Company Logo",className:"h-20 w-auto"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.address}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.phone,a.contact&&` / ${a.contact}`]}),a.email&&e.jsx("p",{className:"text-sm text-gray-600",children:a.email}),a.rccm&&e.jsxs("p",{className:"text-sm text-gray-600",children:["RCCM: ",a.rccm]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-700",children:"FACTURE D'ACHAT"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Référence #: ",t.referenceNumber]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Date: ",new Date(t.date).toLocaleDateString("fr-FR")]})]})]}),e.jsxs("div",{className:"mb-8 p-4 bg-gray-50 rounded-lg border",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Fournisseur"}),e.jsx("p",{className:"font-bold text-gray-800",children:(r==null?void 0:r.name)||"N/A"}),e.jsx("p",{className:"text-sm text-gray-600",children:r==null?void 0:r.address}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r==null?void 0:r.phone," | ",r==null?void 0:r.email]})]})]}),e.jsxs("main",{className:"flex-grow",children:[e.jsxs("table",{className:"w-full mb-8 text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-800 text-white",children:[e.jsx("th",{className:"text-left font-semibold p-3",children:"Produit"}),e.jsx("th",{className:"text-right font-semibold p-3",children:"Quantité"}),e.jsx("th",{className:"text-right font-semibold p-3",children:"Coût Unitaire"}),e.jsx("th",{className:"text-right font-semibold p-3",children:"Sous-total"})]})}),e.jsx("tbody",{children:t.items.map((n,d)=>{const o=i.find(g=>g.id===n.productId);return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-3",children:(o==null?void 0:o.name)||"Produit Inconnu"}),e.jsx("td",{className:"text-right p-3",children:n.quantity}),e.jsx("td",{className:"text-right p-3",children:c(n.cost)}),e.jsx("td",{className:"text-right p-3",children:c(n.subtotal)})]},d)})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"w-full md:w-1/2 lg:w-2/5",children:[e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{className:"text-gray-600",children:"Sous-total articles:"}),e.jsx("span",{className:"font-semibold",children:c(x)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{className:"text-gray-600",children:"Frais de livraison:"}),e.jsx("span",{className:"font-semibold",children:c(t.shippingCost||0)})]}),e.jsxs("div",{className:"flex justify-between py-3 border-t-2 mt-2",children:[e.jsx("span",{className:"font-bold text-lg",children:"Total Général:"}),e.jsx("span",{className:"font-bold text-lg",children:c(t.grandTotal)})]}),e.jsxs("div",{className:"flex justify-between py-2 text-green-600",children:[e.jsx("span",{className:"",children:"Montant Payé:"}),e.jsx("span",{className:"font-semibold",children:c(t.paidAmount)})]}),e.jsxs("div",{className:"flex justify-between py-2 text-red-600 bg-gray-100 p-2 rounded",children:[e.jsx("span",{className:"font-bold",children:"Solde Restant:"}),e.jsx("span",{className:"font-bold",children:c(h)})]})]})}),t.notes&&e.jsxs("div",{className:"mt-8 pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Notes:"}),e.jsx("p",{className:"text-sm text-gray-600 whitespace-pre-wrap",children:t.notes})]})]}),e.jsx("footer",{className:"mt-8 pt-4 border-t text-center text-xs text-gray-500",children:e.jsx("p",{children:a.footerText})})]})},M=()=>{const{id:t}=P(),r=E(),[i,a]=l.useState(null),[c,x]=l.useState(void 0),[h,n]=l.useState([]),[d,o]=l.useState({name:"ETS-DEMO",address:"",phone:"",email:"",contact:"",rccm:"",currencySymbol:"FCFA"}),[g,b]=l.useState(!0),[u,j]=l.useState(null);return l.useEffect(()=>{(async()=>{if(!t){j("ID de l'achat manquant."),b(!1);return}try{const f=v(m,"purchases",t),N=await w(f);if(!N.exists()){j("Facture d'achat introuvable.");return}const y={id:N.id,...N.data()};a(y);const[F,D,p]=await Promise.all([S(C(m,"suppliers")),S(C(m,"products")),w(v(m,"settings","app-config"))]);if(p.exists()){const s=p.data();o({name:s.companyName||"ETS-DEMO",address:s.companyAddress||"",phone:s.companyPhone||"",email:s.companyEmail,contact:s.companyContact,rccm:s.companyRCCM,currencySymbol:s.currencySymbol||"FCFA",logoUrl:s.companyLogoUrl,footerText:s.invoiceFooterText})}const A=F.docs.map(s=>({id:s.id,...s.data()}));x(A.find(s=>s.id===y.supplierId)),n(D.docs.map(s=>({id:s.id,...s.data()})))}catch(f){console.error("Error fetching invoice data:",f),j("Impossible de charger les données de la facture.")}finally{b(!1)}})()},[t]),g?e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Chargement de la facture..."}):u?e.jsx("div",{className:"flex h-screen items-center justify-center text-red-500",children:u}):i?e.jsxs("div",{className:"bg-gray-200 dark:bg-gray-900 min-h-screen invoice-page-container",children:[e.jsxs("header",{className:"no-print bg-white dark:bg-gray-800 p-4 shadow-md flex justify-between items-center sticky top-0 z-10",children:[e.jsxs("h1",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:["Facture d'Achat : ",i.referenceNumber]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>r("/purchases"),className:"flex items-center px-4 py-2 text-sm bg-gray-200 dark:bg-gray-600 rounded-md hover:bg-gray-300",children:[e.jsx(T,{className:"w-5 h-5 mr-2"}),"Retour"]}),e.jsxs("button",{onClick:()=>window.print(),className:"flex items-center px-4 py-2 text-sm text-white bg-primary-600 rounded-md hover:bg-primary-700",children:[e.jsx(R,{className:"w-5 h-5 mr-2"}),"Imprimer / Enregistrer en PDF"]})]})]}),e.jsx("main",{className:"p-4 sm:p-8",children:e.jsx(k,{purchase:i,supplier:c,products:h,companyInfo:d})})]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Facture non trouvée."})};export{M as default};
